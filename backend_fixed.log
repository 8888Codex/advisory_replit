INFO:     Started server process [50948]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
[CloneRegistry] Discovering seed clones...
[CloneRegistry] Registered SEED clone: Al Ries (5 stories)
[CloneRegistry] Registered SEED clone: Ann Handley (5 stories)
[CloneRegistry] Registered SEED clone: Claude Hopkins (5 stories)
[CloneRegistry] Registered SEED clone: Dan Kennedy (5 stories)
[CloneRegistry] Registered SEED clone: Daniel Kahneman (5 stories)
[CloneRegistry] Registered SEED clone: David Aaker (5 stories)
[CloneRegistry] Registered SEED clone: David Ogilvy (5 stories)
[CloneRegistry] Registered SEED clone: Donald Miller (5 stories)
[CloneRegistry] Registered SEED clone: Drayton Bird (5 stories)
[CloneRegistry] Registered SEED clone: Eugene Schwartz (5 stories)
[CloneRegistry] Registered SEED clone: Gary Vaynerchuk (5 stories)
[CloneRegistry] Registered SEED clone: Jay Abraham (5 stories)
[CloneRegistry] Registered SEED clone: Jay Levinson (5 stories)
[CloneRegistry] Registered SEED clone: Neil Patel (5 stories)
[CloneRegistry] Registered SEED clone: Philip Kotler (5 stories)
[CloneRegistry] Registered SEED clone: Robert Cialdini (5 stories)
[CloneRegistry] Registered SEED clone: Seth Godin (5 stories)
[CloneRegistry] Registered SEED clone: Simon Sinek (5 stories)
[CloneRegistry] Discovering custom auto-generated clones...
[CORS] Allowed origins: ['http://localhost:3000', 'http://127.0.0.1:3000', 'http://localhost:5000', 'http://127.0.0.1:5000']
[Startup] Initializing PostgreSQL storage...
[PostgresStorage] Connection pool initialized
[Startup] PostgreSQL storage initialized successfully
[Startup] Seed experts loaded from CloneRegistry. PostgreSQL ready for custom experts.
[DEBUG] Getting experts, category filter: None
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
INFO:     127.0.0.1:53714 - "GET /api/experts HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54596 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:54594 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:54594 - "GET /api/persona/faa07436-f02d-40c7-a990-3c0b5f392c9f?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:54594 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:54596 - "GET /api/persona/list?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '51-200', 'targetAudience': 'Empresas de servi√ßos que utilizando estrat√©gias de inbound para capta√ß√£o de cliente', 'goals': ['growth'], 'mainChallenge': 'Estou com problema para atrair pessoas para o meu funil, n√£o consigo atrair lead qualificado e nem lotar a agenda do meu vendedor', 'enrichmentLevel': 'strategic', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 5, 21, 17, 490579)}
INFO:     127.0.0.1:54594 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Getting experts, category filter: None
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54648 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
INFO:     127.0.0.1:54647 - "GET /api/experts HTTP/1.1" 200 OK
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
INFO:     127.0.0.1:54676 - "GET /api/categories HTTP/1.1" 200 OK
[HISTORY] Getting conversation history for user: 48bb3e53-bfca-4298-bab5-1627ca216739, limit: 50
[HISTORY] Found 0 conversations
[HISTORY] Returning 0 conversations with details
INFO:     127.0.0.1:54697 - "GET /api/conversations/history/user?user_id=48bb3e53-bfca-4298-bab5-1627ca216739&limit=50 HTTP/1.1" 200 OK
[DEBUG] Saving onboarding for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Data received: currentStep=1 companyName='Codex' industry='Agencia de IA' companySize='11-50' targetAudience='' goals=None mainChallenge='' enrichmentLevel='quick'
[DEBUG] Onboarding data dict: {'currentStep': 1, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': '', 'mainChallenge': '', 'enrichmentLevel': 'quick'}
[DEBUG] Save result: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 1, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': '', 'goals': ['growth'], 'mainChallenge': '', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 5, 43, 6, 530445)}
INFO:     127.0.0.1:54755 - "POST /api/onboarding/save?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Saving onboarding for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Data received: currentStep=2 companyName='Codex' industry='Agencia de IA' companySize='11-50' targetAudience='Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente' goals=None mainChallenge='' enrichmentLevel='quick'
[DEBUG] Onboarding data dict: {'currentStep': 2, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': 'Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente', 'mainChallenge': '', 'enrichmentLevel': 'quick'}
[DEBUG] Save result: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 2, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': 'Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente', 'goals': ['growth'], 'mainChallenge': '', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 5, 43, 34, 830080)}
INFO:     127.0.0.1:54767 - "POST /api/onboarding/save?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Saving onboarding for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Data received: currentStep=3 companyName='Codex' industry='Agencia de IA' companySize='11-50' targetAudience='Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente' goals=['growth'] mainChallenge='Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor' enrichmentLevel='quick'
[DEBUG] Onboarding data dict: {'currentStep': 3, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': 'Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente', 'goals': ['growth'], 'mainChallenge': 'Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor', 'enrichmentLevel': 'quick'}
[DEBUG] Save result: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 3, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': 'Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente', 'goals': ['growth'], 'mainChallenge': 'Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 5, 44, 16, 323103)}
INFO:     127.0.0.1:54782 - "POST /api/onboarding/save?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Saving onboarding for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Data received: currentStep=4 companyName='Codex' industry='Agencia de IA' companySize='11-50' targetAudience='Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente' goals=['growth'] mainChallenge='Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor' enrichmentLevel='quick'
[DEBUG] Onboarding data dict: {'currentStep': 4, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': 'Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente', 'goals': ['growth'], 'mainChallenge': 'Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor', 'enrichmentLevel': 'quick'}
[DEBUG] Save result: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': 'Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente', 'goals': ['growth'], 'mainChallenge': 'Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 5, 44, 19, 42393)}
INFO:     127.0.0.1:54782 - "POST /api/onboarding/save?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[PERSONA CREATE] Endpoint called with data: companyName='Codex' industry='Agencia de IA' companySize='11-50' targetAudience='Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente' mainProducts=None channels=[] budgetRange=None primaryGoal='growth' mainChallenge='Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor' timeline=None researchMode='strategic' enrichmentLevel='quick' additionalContext=None
[PERSONA CREATE] Using user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[PERSONA CREATE] Calling storage.create_user_persona...
[PERSONA CREATE] Persona created successfully: ae4237e4-d0f1-484b-ab27-041fdcfdf913
INFO:     127.0.0.1:54782 - "POST /api/persona/create?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 201 Created
[ENRICH_ENDPOINT] Received enrichment request for persona ae4237e4-d0f1-484b-ab27-041fdcfdf913 with mode quick
[ENRICH_ENDPOINT] Persona found. Adding background task...
[ENRICH_ENDPOINT] Persona ID: ae4237e4-d0f1-484b-ab27-041fdcfdf913, Mode: quick
[ENRICH_ENDPOINT] background_tasks object: <fastapi.background.BackgroundTasks object at 0x106e77ce0>
[ENRICH_ENDPOINT] Background task added successfully. Returning 202 response.
[ENRICH_ENDPOINT] Task should execute after response is sent...
INFO:     127.0.0.1:54782 - "POST /api/persona/enrich/background?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 202 Accepted
[BACKGROUND] üîß Sync wrapper called for persona ae4237e4-d0f1-484b-ab27-041fdcfdf913
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[BACKGROUND] ‚ö° Async enrichment task STARTED for persona ae4237e4-d0f1-484b-ab27-041fdcfdf913 with level quick
[BACKGROUND] Creating database connection...
INFO:     127.0.0.1:54794 - "POST /api/onboarding/complete?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 400 Bad Request
INFO:     127.0.0.1:54795 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[BACKGROUND] Updating status to 'processing'...
[BACKGROUND] Status updated. Starting quick enrichment...
[BACKGROUND] Fetching persona data...
[BACKGROUND] Persona found. Starting COMPLETE enrichment...
[BACKGROUND] Company: Codex
[BACKGROUND] Industry: Agencia de IA
[BACKGROUND] Level: quick
[BACKGROUND] Calling COMPLETE enrichment (YouTube + 8 modules)...
[STANDALONE ENRICHMENT] Starting QUICK enrichment...
[STANDALONE ENRICHMENT] Company: Codex
[STANDALONE ENRICHMENT] Industry: Agencia de IA
[STANDALONE ENRICHMENT] Phase 1: YouTube Research...
[YOUTUBE] Searching: Agencia de IA marketing strategy
[YOUTUBE] Searching: Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente buyer persona
[YOUTUBE] Found 10 videos
[YOUTUBE] Warning: Expecting value: line 1 column 1 (char 0)
[STANDALONE ENRICHMENT] Phase 2: Generating Deep Modules...
[MODULES] Generating: psychographicCore...
[DB] Saved psychographicCore to database
[MODULES] Generating: buyerJourney...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54892 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:54891 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:54892 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:54891 - "GET /api/persona/list?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:54891 - "GET /api/persona/ae4237e4-d0f1-484b-ab27-041fdcfdf913?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54891 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54932 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DB] Saved buyerJourney to database
[MODULES] Generating: strategicInsights...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54942 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54954 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DB] Saved strategicInsights to database
[STANDALONE ENRICHMENT] Phase 3: Base Fields...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54961 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54967 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[STANDALONE ENRICHMENT] ‚úÖ Enrichment COMPLETE!
[STANDALONE ENRICHMENT] Modules generated: 5
[STANDALONE ENRICHMENT] YouTube videos: 0
[BACKGROUND] ‚úÖ Enrichment COMPLETE!
[BACKGROUND] Generated modules: ['youtube', 'psychographicCore', 'buyerJourney', 'strategicInsights', 'baseFields']
[BACKGROUND] YouTube videos: 0
[BACKGROUND] Enrichment completed, marking as 'completed'...
[BACKGROUND] ‚úÖ Enrichment completed successfully!
[BACKGROUND] Database connection closed
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:54977 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[Analytics] Error getting top experts: column ua.metadata does not exist
INFO:     127.0.0.1:55030 - "GET /api/analytics/top-experts HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting category distribution: column ua.metadata does not exist
INFO:     127.0.0.1:55027 - "GET /api/analytics/categories HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting overview: column "metadata" does not exist
INFO:     127.0.0.1:55029 - "GET /api/analytics/overview HTTP/1.1" 500 Internal Server Error
[Analytics] Error generating recommendations: column "metadata" does not exist
INFO:     127.0.0.1:55031 - "GET /api/analytics/recommendations HTTP/1.1" 200 OK
INFO:     127.0.0.1:55026 - "GET /api/analytics/timeline HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:57471 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:57470 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:57470 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:57471 - "GET /api/persona/list?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:57515 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
ConnectionResetError: [Errno 54] Connection reset by peer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Downloads/Andromeda/advisory_replit/python_backend/main.py", line 231, in get_current_user
    user = await storage.get_user_by_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Downloads/Andromeda/advisory_replit/python_backend/storage.py", line 989, in get_user_by_id
    row = await conn.fetchrow("""
          ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 748, in fetchrow
    data = await self._execute(
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 1864, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 1961, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 2012, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation
Error fetching enrichment status: connection was closed in the middle of operation
INFO:     127.0.0.1:57514 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 500 Internal Server Error
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:57609 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:59300 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59301 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:59474 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59477 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Getting experts, category filter: None
INFO:     127.0.0.1:59681 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': 'Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente', 'goals': ['growth'], 'mainChallenge': 'Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 5, 44, 19, 42393)}
INFO:     127.0.0.1:59680 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
INFO:     127.0.0.1:59682 - "GET /api/experts HTTP/1.1" 200 OK
INFO:     127.0.0.1:59717 - "GET /api/experts/seed-ann-handley HTTP/1.1" 200 OK
[DEBUG] Creating conversation for user 48bb3e53-bfca-4298-bab5-1627ca216739 with data: expertId='seed-ann-handley' title='Conversa com Ann Handley'
[DEBUG] Getting expert: seed-ann-handley
[DEBUG] Expert found: Ann Handley
[DEBUG] Calling storage.create_conversation...
[DEBUG] Conversation created: a20a5675-9819-4cb2-b8e0-fbb426533c3a
INFO:     127.0.0.1:59680 - "POST /api/conversations?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 201 Created
INFO:     127.0.0.1:59722 - "GET /api/conversations/a20a5675-9819-4cb2-b8e0-fbb426533c3a/messages HTTP/1.1" 200 OK
INFO:     127.0.0.1:59680 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59740 - "GET /api/persona/list?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59680 - "GET /api/persona/ae4237e4-d0f1-484b-ab27-041fdcfdf913?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59719 - "GET /api/experts/seed-ann-handley/suggested-questions HTTP/1.1" 200 OK
[Analytics] Error getting overview: column "metadata" does not exist
INFO:     127.0.0.1:60787 - "GET /api/analytics/overview HTTP/1.1" 500 Internal Server Error
[Analytics] Error generating recommendations: column "metadata" does not exist
INFO:     127.0.0.1:60784 - "GET /api/analytics/recommendations HTTP/1.1" 200 OK
INFO:     127.0.0.1:60785 - "GET /api/analytics/timeline HTTP/1.1" 200 OK
[Analytics] Error getting category distribution: column ua.metadata does not exist
INFO:     127.0.0.1:60786 - "GET /api/analytics/categories HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting top experts: column ua.metadata does not exist
INFO:     127.0.0.1:60788 - "GET /api/analytics/top-experts HTTP/1.1" 500 Internal Server Error
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Codex', 'industry': 'Agencia de IA', 'companySize': '11-50', 'targetAudience': 'Empresas de servi√ßos que utilizam estrat√©gias de inbound para capta√ß√£o de cliente', 'goals': ['growth'], 'mainChallenge': 'Estou com problema em atrair clientes para o funil, est√° com baixa qualidade e n√£o estou conseguindo encher a agenda do meu vendedor', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 5, 44, 19, 42393)}
INFO:     127.0.0.1:60820 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Saving onboarding for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Data received: currentStep=1 companyName='Cognita ' industry='Educacional' companySize='1-10' targetAudience='' goals=None mainChallenge='' enrichmentLevel='quick'
[DEBUG] Onboarding data dict: {'currentStep': 1, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': '', 'mainChallenge': '', 'enrichmentLevel': 'quick'}
[DEBUG] Save result: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 1, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': '', 'goals': ['growth'], 'mainChallenge': '', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 16, 38, 52, 550778)}
INFO:     127.0.0.1:60845 - "POST /api/onboarding/save?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Saving onboarding for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Data received: currentStep=2 companyName='Cognita ' industry='Educacional' companySize='1-10' targetAudience='Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ' goals=None mainChallenge='' enrichmentLevel='quick'
[DEBUG] Onboarding data dict: {'currentStep': 2, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ', 'mainChallenge': '', 'enrichmentLevel': 'quick'}
[DEBUG] Save result: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 2, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ', 'goals': ['growth'], 'mainChallenge': '', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 16, 39, 18, 446677)}
INFO:     127.0.0.1:60852 - "POST /api/onboarding/save?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Saving onboarding for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Data received: currentStep=3 companyName='Cognita ' industry='Educacional' companySize='1-10' targetAudience='Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ' goals=['growth'] mainChallenge='Dificuldade em atrair clientes para o nossa mentoria e workshop' enrichmentLevel='quick'
[DEBUG] Onboarding data dict: {'currentStep': 3, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ', 'goals': ['growth'], 'mainChallenge': 'Dificuldade em atrair clientes para o nossa mentoria e workshop', 'enrichmentLevel': 'quick'}
[DEBUG] Save result: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 3, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ', 'goals': ['growth'], 'mainChallenge': 'Dificuldade em atrair clientes para o nossa mentoria e workshop', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 16, 39, 47, 811023)}
INFO:     127.0.0.1:60867 - "POST /api/onboarding/save?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Saving onboarding for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Data received: currentStep=4 companyName='Cognita ' industry='Educacional' companySize='1-10' targetAudience='Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ' goals=['growth'] mainChallenge='Dificuldade em atrair clientes para o nossa mentoria e workshop' enrichmentLevel='strategic'
[DEBUG] Onboarding data dict: {'currentStep': 4, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ', 'goals': ['growth'], 'mainChallenge': 'Dificuldade em atrair clientes para o nossa mentoria e workshop', 'enrichmentLevel': 'strategic'}
[DEBUG] Save result: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ', 'goals': ['growth'], 'mainChallenge': 'Dificuldade em atrair clientes para o nossa mentoria e workshop', 'enrichmentLevel': 'strategic', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 16, 39, 50, 560723)}
INFO:     127.0.0.1:60867 - "POST /api/onboarding/save?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[PERSONA CREATE] Endpoint called with data: companyName='Cognita ' industry='Educacional' companySize='1-10' targetAudience='Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ' mainProducts=None channels=[] budgetRange=None primaryGoal='growth' mainChallenge='Dificuldade em atrair clientes para o nossa mentoria e workshop' timeline=None researchMode='strategic' enrichmentLevel='strategic' additionalContext=None
[PERSONA CREATE] Using user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[PERSONA CREATE] Calling storage.create_user_persona...
[PERSONA CREATE] Persona created successfully: 35a44885-fcec-48ed-8150-403ca7ee46d9
INFO:     127.0.0.1:60867 - "POST /api/persona/create?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 201 Created
[ENRICH_ENDPOINT] Received enrichment request for persona 35a44885-fcec-48ed-8150-403ca7ee46d9 with mode strategic
[ENRICH_ENDPOINT] Persona found. Adding background task...
[ENRICH_ENDPOINT] Persona ID: 35a44885-fcec-48ed-8150-403ca7ee46d9, Mode: strategic
[ENRICH_ENDPOINT] background_tasks object: <fastapi.background.BackgroundTasks object at 0x11dac6ff0>
[ENRICH_ENDPOINT] Background task added successfully. Returning 202 response.
[ENRICH_ENDPOINT] Task should execute after response is sent...
INFO:     127.0.0.1:60867 - "POST /api/persona/enrich/background?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 202 Accepted
[BACKGROUND] üîß Sync wrapper called for persona 35a44885-fcec-48ed-8150-403ca7ee46d9
[BACKGROUND] ‚ö° Async enrichment task STARTED for persona 35a44885-fcec-48ed-8150-403ca7ee46d9 with level strategic
[BACKGROUND] Creating database connection...
INFO:     127.0.0.1:60867 - "POST /api/onboarding/complete?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 400 Bad Request
[DEBUG] Getting experts, category filter: None
[BACKGROUND] Updating status to 'processing'...
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[BACKGROUND] Status updated. Starting strategic enrichment...
[BACKGROUND] Fetching persona data...
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
INFO:     127.0.0.1:60877 - "GET /api/experts HTTP/1.1" 200 OK
[BACKGROUND] Persona found. Starting COMPLETE enrichment...
[BACKGROUND] Company: Cognita 
[BACKGROUND] Industry: Educacional
[BACKGROUND] Level: strategic
[BACKGROUND] Calling COMPLETE enrichment (YouTube + 8 modules)...
[STANDALONE ENRICHMENT] Starting STRATEGIC enrichment...
[STANDALONE ENRICHMENT] Company: Cognita 
[STANDALONE ENRICHMENT] Industry: Educacional
[STANDALONE ENRICHMENT] Phase 1: YouTube Research...
[YOUTUBE] Searching: Educacional marketing strategy
INFO:     127.0.0.1:60867 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[YOUTUBE] Searching: Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial.  buyer persona
[YOUTUBE] Found 10 videos
[STANDALONE ENRICHMENT] Phase 2: Generating Deep Modules...
[MODULES] Generating: psychographicCore...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:60929 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:60930 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:60929 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:60930 - "GET /api/persona/list?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:60947 - "GET /api/persona/35a44885-fcec-48ed-8150-403ca7ee46d9?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:60947 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DB] Saved psychographicCore to database
[MODULES] Generating: buyerJourney...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:60974 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:60979 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DB] Saved buyerJourney to database
[MODULES] Generating: behavioralProfile...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:60983 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:60987 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DB] Saved behavioralProfile to database
[MODULES] Generating: languageCommunication...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:60990 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DB] Saved languageCommunication to database
[MODULES] Generating: strategicInsights...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:60993 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:61019 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DB] Saved strategicInsights to database
[MODULES] Generating: jobsToBeDone...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:61025 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:61032 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DB] Saved jobsToBeDone to database
[STANDALONE ENRICHMENT] Phase 3: Base Fields...
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:61039 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[STANDALONE ENRICHMENT] ‚úÖ Enrichment COMPLETE!
[STANDALONE ENRICHMENT] Modules generated: 8
[STANDALONE ENRICHMENT] YouTube videos: 10
[BACKGROUND] ‚úÖ Enrichment COMPLETE!
[BACKGROUND] Generated modules: ['youtube', 'psychographicCore', 'buyerJourney', 'behavioralProfile', 'languageCommunication', 'strategicInsights', 'jobsToBeDone', 'baseFields']
[BACKGROUND] YouTube videos: 10
[BACKGROUND] Enrichment completed, marking as 'completed'...
[BACKGROUND] ‚úÖ Enrichment completed successfully!
[BACKGROUND] Database connection closed
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:61045 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Getting experts, category filter: None
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
INFO:     127.0.0.1:61153 - "GET /api/experts HTTP/1.1" 200 OK
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
INFO:     127.0.0.1:61155 - "GET /api/categories HTTP/1.1" 200 OK
[DEBUG] Getting experts, category filter: marketing
INFO:     127.0.0.1:61175 - "GET /api/experts/recommendations HTTP/1.1" 200 OK
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
[DEBUG] After category filter: 11
INFO:     127.0.0.1:61176 - "GET /api/experts?category=marketing HTTP/1.1" 200 OK
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empres√°rios de Sao Paulo, que estao em busca de conhecimentov sobre intelig√™ncia artificial. ', 'goals': ['growth'], 'mainChallenge': 'Dificuldade em atrair clientes para o nossa mentoria e workshop', 'enrichmentLevel': 'strategic', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 16, 39, 50, 560723)}
INFO:     127.0.0.1:61206 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:61208 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:61238 - "GET /api/persona/ae4237e4-d0f1-484b-ab27-041fdcfdf913?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [50948]
