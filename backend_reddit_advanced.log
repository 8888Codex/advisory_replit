INFO:     Started server process [45665]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:5001 (Press CTRL+C to quit)
[CloneRegistry] Discovering seed clones...
[CloneRegistry] Registered SEED clone: Al Ries (5 stories)
[CloneRegistry] Registered SEED clone: Ann Handley (5 stories)
[CloneRegistry] Registered SEED clone: Claude Hopkins (5 stories)
[CloneRegistry] Registered SEED clone: Dan Kennedy (5 stories)
[CloneRegistry] Registered SEED clone: Daniel Kahneman (5 stories)
[CloneRegistry] Registered SEED clone: David Aaker (5 stories)
[CloneRegistry] Registered SEED clone: David Ogilvy (5 stories)
[CloneRegistry] Registered SEED clone: Donald Miller (5 stories)
[CloneRegistry] Registered SEED clone: Drayton Bird (5 stories)
[CloneRegistry] Registered SEED clone: Eugene Schwartz (5 stories)
[CloneRegistry] Registered SEED clone: Gary Vaynerchuk (5 stories)
[CloneRegistry] Registered SEED clone: Jay Abraham (5 stories)
[CloneRegistry] Registered SEED clone: Jay Levinson (5 stories)
[CloneRegistry] Registered SEED clone: Neil Patel (5 stories)
[CloneRegistry] Registered SEED clone: Philip Kotler (5 stories)
[CloneRegistry] Registered SEED clone: Robert Cialdini (5 stories)
[CloneRegistry] Registered SEED clone: Seth Godin (5 stories)
[CloneRegistry] Registered SEED clone: Simon Sinek (5 stories)
[CloneRegistry] Discovering custom auto-generated clones...
[CORS] Allowed origins: ['http://localhost:3000', 'http://127.0.0.1:3000', 'http://localhost:5000', 'http://127.0.0.1:5000']
[Startup] Initializing PostgreSQL storage...
[PostgresStorage] Connection pool initialized
[Startup] PostgreSQL storage initialized successfully
[Startup] Seed experts loaded from CloneRegistry. PostgreSQL ready for custom experts.
[DEBUG] Getting experts, category filter: None
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
INFO:     127.0.0.1:64711 - "GET /api/experts HTTP/1.1" 200 OK
INFO:     127.0.0.1:64722 - "POST /api/auth/login HTTP/1.1" 200 OK
INFO:     127.0.0.1:64724 - "POST /api/audit/log HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Downloads/Andromeda/advisory_replit/python_backend/main.py", line 421, in create_audit_log
    log_id = await storage.create_audit_log(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Downloads/Andromeda/advisory_replit/python_backend/storage.py", line 1364, in create_audit_log
    await conn.execute("""
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 352, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 1864, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 1961, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 2012, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedColumnError: column "metadata" of relation "audit_logs" does not exist
INFO:     127.0.0.1:64722 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empresários de Sao Paulo, que estao em busca de conhecimentov sobre inteligência artificial. ', 'goals': ['growth'], 'mainChallenge': 'Dificuldade em atrair clientes para o nossa mentoria e workshop', 'enrichmentLevel': 'strategic', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 16, 39, 50, 560723)}
INFO:     127.0.0.1:64722 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64737 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64737 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64722 - "GET /api/persona/list?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64722 - "GET /api/persona/35a44885-fcec-48ed-8150-403ca7ee46d9?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64756 - "GET /api/persona/ae4237e4-d0f1-484b-ab27-041fdcfdf913?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[HISTORY] Getting conversation history for user: 48bb3e53-bfca-4298-bab5-1627ca216739, limit: 50
[HISTORY] Found 1 conversations
[HISTORY] Returning 1 conversations with details
INFO:     127.0.0.1:64778 - "GET /api/conversations/history/user?user_id=48bb3e53-bfca-4298-bab5-1627ca216739&limit=50 HTTP/1.1" 200 OK
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
INFO:     127.0.0.1:64782 - "GET /api/categories HTTP/1.1" 200 OK
[Analytics] Error getting overview: column "metadata" does not exist
INFO:     127.0.0.1:64898 - "GET /api/analytics/overview HTTP/1.1" 500 Internal Server Error
INFO:     127.0.0.1:64900 - "GET /api/analytics/timeline HTTP/1.1" 200 OK
[Analytics] Error getting top experts: column ua.metadata does not exist
INFO:     127.0.0.1:64910 - "GET /api/analytics/top-experts HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting category distribution: column ua.metadata does not exist
INFO:     127.0.0.1:64905 - "GET /api/analytics/categories HTTP/1.1" 500 Internal Server Error
[Analytics] Error generating recommendations: column "metadata" does not exist
INFO:     127.0.0.1:64907 - "GET /api/analytics/recommendations HTTP/1.1" 200 OK
[DEBUG] Getting experts, category filter: marketing
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
[DEBUG] After category filter: 11
INFO:     127.0.0.1:64940 - "GET /api/experts?category=marketing HTTP/1.1" 200 OK
INFO:     127.0.0.1:64939 - "GET /api/experts/recommendations HTTP/1.1" 200 OK
[DEBUG] Getting experts, category filter: growth
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
[DEBUG] After category filter: 4
INFO:     127.0.0.1:64960 - "GET /api/experts?category=growth HTTP/1.1" 200 OK
[DEBUG] Getting experts, category filter: direct_response
[DEDUP] SEED experts: 18, DB experts: 22, Unique DB: 14
[DEDUP] Removed 8 duplicate(s) from DB (already in SEED)
[DEBUG] Total experts loaded: 32
[DEBUG] After category filter: 4
INFO:     127.0.0.1:64981 - "GET /api/experts?category=direct_response HTTP/1.1" 200 OK
[Analytics] Error getting category distribution: column ua.metadata does not exist
INFO:     127.0.0.1:65004 - "GET /api/analytics/categories HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting top experts: column ua.metadata does not exist
INFO:     127.0.0.1:65003 - "GET /api/analytics/top-experts HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting overview: column "metadata" does not exist
INFO:     127.0.0.1:65006 - "GET /api/analytics/overview HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting top experts: column ua.metadata does not exist
INFO:     127.0.0.1:65048 - "GET /api/analytics/top-experts HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting overview: column "metadata" does not exist
INFO:     127.0.0.1:65047 - "GET /api/analytics/overview HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting category distribution: column ua.metadata does not exist
INFO:     127.0.0.1:65049 - "GET /api/analytics/categories HTTP/1.1" 500 Internal Server Error
[Analytics] Error getting overview: column "metadata" does not exist
INFO:     127.0.0.1:65091 - "GET /api/analytics/overview HTTP/1.1" 500 Internal Server Error
INFO:     127.0.0.1:65142 - "GET /api/analytics/overview HTTP/1.1" 200 OK
INFO:     127.0.0.1:65147 - "GET /api/analytics/timeline HTTP/1.1" 200 OK
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Cognita ', 'industry': 'Educacional', 'companySize': '1-10', 'targetAudience': 'Empresários de Sao Paulo, que estao em busca de conhecimentov sobre inteligência artificial. ', 'goals': ['growth'], 'mainChallenge': 'Dificuldade em atrair clientes para o nossa mentoria e workshop', 'enrichmentLevel': 'strategic', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 16, 39, 50, 560723)}
INFO:     127.0.0.1:65177 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:65182 - "GET /api/experts/seed-dan-kennedy HTTP/1.1" 200 OK
[DEBUG] Creating conversation for user 48bb3e53-bfca-4298-bab5-1627ca216739 with data: expertId='seed-dan-kennedy' title='Conversa com Dan Kennedy'
[DEBUG] Getting expert: seed-dan-kennedy
[DEBUG] Expert found: Dan Kennedy
[DEBUG] Calling storage.create_conversation...
[DEBUG] Conversation created: 25f57555-d1bd-4ac4-b69c-806d7188133d
INFO:     127.0.0.1:65177 - "POST /api/conversations?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 201 Created
INFO:     127.0.0.1:65187 - "GET /api/conversations/25f57555-d1bd-4ac4-b69c-806d7188133d/messages HTTP/1.1" 200 OK
INFO:     127.0.0.1:65184 - "GET /api/experts/seed-dan-kennedy/suggested-questions HTTP/1.1" 200 OK
[LegendAgentFactory] Loaded rich clone for Dan Kennedy (5 story banks)
INFO:     127.0.0.1:65212 - "POST /api/conversations/25f57555-d1bd-4ac4-b69c-806d7188133d/messages HTTP/1.1" 201 Created
INFO:     127.0.0.1:65235 - "GET /api/conversations/25f57555-d1bd-4ac4-b69c-806d7188133d/messages HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [45665]
