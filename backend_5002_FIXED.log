INFO:     Started server process [5741]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:5002 (Press CTRL+C to quit)
[CloneRegistry] Discovering seed clones...
[CloneRegistry] Registered SEED clone: Al Ries (5 stories)
[CloneRegistry] Registered SEED clone: Ann Handley (5 stories)
[CloneRegistry] Registered SEED clone: Claude Hopkins (5 stories)
[CloneRegistry] Registered SEED clone: Dan Kennedy (5 stories)
[CloneRegistry] Registered SEED clone: Daniel Kahneman (5 stories)
[CloneRegistry] Registered SEED clone: David Aaker (5 stories)
[CloneRegistry] Registered SEED clone: David Ogilvy (5 stories)
[CloneRegistry] Registered SEED clone: Donald Miller (5 stories)
[CloneRegistry] Registered SEED clone: Drayton Bird (5 stories)
[CloneRegistry] Registered SEED clone: Eugene Schwartz (5 stories)
[CloneRegistry] Registered SEED clone: Gary Vaynerchuk (5 stories)
[CloneRegistry] Registered SEED clone: Jay Abraham (5 stories)
[CloneRegistry] Registered SEED clone: Jay Levinson (5 stories)
[CloneRegistry] Registered SEED clone: Neil Patel (5 stories)
[CloneRegistry] Registered SEED clone: Philip Kotler (5 stories)
[CloneRegistry] Registered SEED clone: Robert Cialdini (5 stories)
[CloneRegistry] Registered SEED clone: Seth Godin (5 stories)
[CloneRegistry] Registered SEED clone: Simon Sinek (5 stories)
[CloneRegistry] Discovering custom auto-generated clones...
[CORS] Allowed origins: ['http://localhost:3000', 'http://127.0.0.1:3000', 'http://localhost:5000', 'http://127.0.0.1:5000']
[Startup] Initializing PostgreSQL storage...
[PostgresStorage] Connection pool initialized
[Startup] PostgreSQL storage initialized successfully
[Startup] Seed experts loaded from CloneRegistry. PostgreSQL ready for custom experts.
INFO:     127.0.0.1:61727 - "GET /health HTTP/1.1" 404 Not Found
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:61896 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:61895 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62425 - "POST /api/auth/login HTTP/1.1" 200 OK
INFO:     127.0.0.1:62428 - "POST /api/audit/log HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/fastapi/routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Downloads/Andromeda/advisory_replit/python_backend/main.py", line 421, in create_audit_log
    log_id = await storage.create_audit_log(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Downloads/Andromeda/advisory_replit/python_backend/storage.py", line 1368, in create_audit_log
    await conn.execute("""
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 352, in execute
    _, status, _ = await self._execute(
                   ^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 1864, in _execute
    result, _ = await self.__execute(
                ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 1961, in __execute
    result, stmt = await self._do_execute(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 2012, in _do_execute
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gabriellima/Library/Python/3.12/lib/python/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedColumnError: column "metadata" of relation "audit_logs" does not exist
INFO:     127.0.0.1:62425 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Getting experts, category filter: None
[DEDUP] SEED experts: 18, DB experts: 1, Unique DB: 1
[DEBUG] Total experts loaded: 19
INFO:     127.0.0.1:62435 - "GET /api/experts HTTP/1.1" 200 OK
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:62425 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Codex', 'industry': 'IA', 'companySize': '1-10', 'targetAudience': 'Empresas de serviços que utilizam estratégias de inbound para captação de cliente\n\n', 'goals': ['growth'], 'mainChallenge': 'Preciso trazer mais clientes para minha esteira de vendas, uso estratégia de inbound, mas nao estou conseguindo lotar a agenda do meu time comercial ', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 19, 48, 18, 63933)}
INFO:     127.0.0.1:62444 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62464 - "GET /api/analytics/timeline HTTP/1.1" 200 OK
INFO:     127.0.0.1:62462 - "GET /api/analytics/categories HTTP/1.1" 200 OK
INFO:     127.0.0.1:62463 - "GET /api/analytics/top-experts HTTP/1.1" 200 OK
INFO:     127.0.0.1:62455 - "GET /api/analytics/overview HTTP/1.1" 200 OK
[LLM Router] Using Claude Haiku for recommend_experts (cost-optimized ~92% cheaper)
[ENRICHMENT STATUS] Fetching for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:62483 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62481 - "GET /api/persona/enrichment-status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62461 - "GET /api/analytics/recommendations HTTP/1.1" 200 OK
INFO:     127.0.0.1:62488 - "GET /api/analytics/timeline HTTP/1.1" 200 OK
INFO:     127.0.0.1:62491 - "GET /api/analytics/categories HTTP/1.1" 200 OK
INFO:     127.0.0.1:62490 - "GET /api/analytics/top-experts HTTP/1.1" 200 OK
INFO:     127.0.0.1:62493 - "GET /api/analytics/overview HTTP/1.1" 200 OK
[LLM Router] Using Claude Haiku for recommend_experts (cost-optimized ~92% cheaper)
INFO:     127.0.0.1:62483 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62481 - "GET /api/persona/list?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62489 - "GET /api/analytics/recommendations HTTP/1.1" 200 OK
[DEBUG] Getting experts, category filter: None
[DEDUP] SEED experts: 18, DB experts: 1, Unique DB: 1
[DEBUG] Total experts loaded: 19
INFO:     127.0.0.1:62507 - "GET /api/experts HTTP/1.1" 200 OK
[HISTORY] Getting conversation history for user: 48bb3e53-bfca-4298-bab5-1627ca216739, limit: 50
[HISTORY] Found 0 conversations
[HISTORY] Returning 0 conversations with details
INFO:     127.0.0.1:62518 - "GET /api/conversations/history/user?user_id=48bb3e53-bfca-4298-bab5-1627ca216739&limit=50 HTTP/1.1" 200 OK
[DEDUP] SEED experts: 18, DB experts: 1, Unique DB: 1
INFO:     127.0.0.1:62520 - "GET /api/categories HTTP/1.1" 200 OK
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:62860 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Codex', 'industry': 'IA', 'companySize': '1-10', 'targetAudience': 'Empresas de serviços que utilizam estratégias de inbound para captação de cliente\n\n', 'goals': ['growth'], 'mainChallenge': 'Preciso trazer mais clientes para minha esteira de vendas, uso estratégia de inbound, mas nao estou conseguindo lotar a agenda do meu time comercial ', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 19, 48, 18, 63933)}
INFO:     127.0.0.1:62862 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:62917 - "GET /api/experts/seed-claude-hopkins HTTP/1.1" 200 OK
[DEBUG] Creating conversation for user 48bb3e53-bfca-4298-bab5-1627ca216739 with data: expertId='seed-claude-hopkins' title='Conversa com Claude Hopkins'
[DEBUG] Getting expert: seed-claude-hopkins
[DEBUG] Expert found: Claude Hopkins
[DEBUG] Calling storage.create_conversation...
[DEBUG] Conversation created: 40d8ddc9-728c-422a-979f-b82526cba62c
INFO:     127.0.0.1:62923 - "POST /api/conversations?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 201 Created
INFO:     127.0.0.1:62928 - "GET /api/conversations/40d8ddc9-728c-422a-979f-b82526cba62c/messages HTTP/1.1" 200 OK
INFO:     127.0.0.1:62925 - "GET /api/experts/seed-claude-hopkins/suggested-questions HTTP/1.1" 200 OK
[DEBUG] Getting onboarding status for user: 48bb3e53-bfca-4298-bab5-1627ca216739
[PERSONA CURRENT] Fetching persona for user_id: 48bb3e53-bfca-4298-bab5-1627ca216739
INFO:     127.0.0.1:64380 - "GET /api/persona/current?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEBUG] Onboarding status found: {'id': '6cb89662-7d11-42ac-a718-1e168d0f3a3a', 'userId': '48bb3e53-bfca-4298-bab5-1627ca216739', 'currentStep': 4, 'companyName': 'Codex', 'industry': 'IA', 'companySize': '1-10', 'targetAudience': 'Empresas de serviços que utilizam estratégias de inbound para captação de cliente\n\n', 'goals': ['growth'], 'mainChallenge': 'Preciso trazer mais clientes para minha esteira de vendas, uso estratégia de inbound, mas nao estou conseguindo lotar a agenda do meu time comercial ', 'enrichmentLevel': 'quick', 'completedAt': datetime.datetime(2025, 11, 10, 2, 56, 46, 16133), 'createdAt': datetime.datetime(2025, 11, 10, 2, 55, 27, 876980), 'updatedAt': datetime.datetime(2025, 11, 10, 19, 48, 18, 63933)}
INFO:     127.0.0.1:64379 - "GET /api/onboarding/status?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[DEDUP] SEED experts: 18, DB experts: 1, Unique DB: 1
INFO:     127.0.0.1:64390 - "GET /api/categories HTTP/1.1" 200 OK
[HISTORY] Getting conversation history for user: 48bb3e53-bfca-4298-bab5-1627ca216739, limit: 50
[HISTORY] Found 1 conversations
[HISTORY] Returning 1 conversations with details
INFO:     127.0.0.1:64394 - "GET /api/conversations/history/user?user_id=48bb3e53-bfca-4298-bab5-1627ca216739&limit=50 HTTP/1.1" 200 OK
[DELETE] User 48bb3e53-bfca-4298-bab5-1627ca216739 deleting conversation 40d8ddc9-728c-422a-979f-b82526cba62c
[DELETE] Conversation 40d8ddc9-728c-422a-979f-b82526cba62c deleted successfully
INFO:     127.0.0.1:64394 - "DELETE /api/conversations/40d8ddc9-728c-422a-979f-b82526cba62c?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
[HISTORY] Getting conversation history for user: 48bb3e53-bfca-4298-bab5-1627ca216739, limit: 50
[HISTORY] Found 0 conversations
[HISTORY] Returning 0 conversations with details
INFO:     127.0.0.1:64394 - "GET /api/conversations/history/user?user_id=48bb3e53-bfca-4298-bab5-1627ca216739&limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64412 - "GET /api/auth/me?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64394 - "GET /api/persona/list?user_id=48bb3e53-bfca-4298-bab5-1627ca216739 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64422 - "GET /api/analytics/timeline HTTP/1.1" 200 OK
INFO:     127.0.0.1:64423 - "GET /api/analytics/top-experts HTTP/1.1" 200 OK
INFO:     127.0.0.1:64425 - "GET /api/analytics/categories HTTP/1.1" 200 OK
INFO:     127.0.0.1:64424 - "GET /api/analytics/overview HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for connections to close. (CTRL+C to force quit)
[LLM Router] Using Claude Haiku for recommend_experts (cost-optimized ~92% cheaper)
INFO:     127.0.0.1:64426 - "GET /api/analytics/recommendations HTTP/1.1" 200 OK
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [5741]
